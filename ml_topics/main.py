from ollama import Client
from topics import TOPICS
import os

client = Client(host=os.getenv("OLLAMA_HOST"))


def get_topics(text: str) -> list[str]:
    format_string = '{"topics": ["topic1", ...]}'

    system_prompt = f"""
        –¢—ã ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π —Ç–µ–º–∞—Ç–∏–∫—É Telegram-–ø–æ—Å—Ç–æ–≤.

        –ù–∞–∑–æ–≤–∏ 1‚Äì5 –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ç–µ–º –∏–∑ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞:
        {", ".join(TOPICS)}

        –û—Ç–≤–µ—Ç —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
        {format_string}
    """

    prompt = f"""–¢–µ–∫—Å—Ç: {text}"""
    response = client.chat(model='qwen3:4b',
        messages=[
            {"role": "system", "content": system_prompt},
            {'role': 'user', 'content': prompt}
            ],
        options={
            "temperature": 0.0
            })

    raw = response['message']['content']
    return raw

# üî¨ –ü—Ä–∏–º–µ—Ä –ø–æ—Å—Ç–∞ –∏–∑ Telegram
post = """–°–°–°–† ¬´—é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –≤–µ–¥—å –≥–¥–µ-—Ç–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç¬ª, –æ —á–µ–º –¥–∞–≤–Ω–æ –≥–æ–≤–æ—Ä—è—Ç —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –ø–æ –∫–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–Ω–æ–º—É –ø—Ä–∞–≤—É, –≤ —Ç–æ–º —á–∏—Å–ª–µ –Ω–∞ –ó–∞–ø–∞–¥–µ, ‚Äî –∑–∞—è–≤–∏–ª —Å–æ–≤–µ—Ç–Ω–∏–∫ –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞ –†–æ—Å—Å–∏–∏ –ê–Ω—Ç–æ–Ω –ö–æ–±—è–∫–æ–≤

¬´–ê –ø–æ—á–µ–º—É –æ–Ω–∏ —Ç–∞–∫ –≥–æ–≤–æ—Ä—è—Ç? –û–Ω–∏ –≥–æ–≤–æ—Ä—è—Ç —Ç–∞–∫ –ø–æ—Ç–æ–º—É, —á—Ç–æ –±—ã–ª–∞ –Ω–∞—Ä—É—à–µ–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º–æ–≥–æ —Ä–æ—Å–ø—É—Å–∫–∞ –°–°–°–†. –ï—Å–ª–∏ –°—ä–µ–∑–¥ –Ω–∞—Ä–æ–¥–Ω—ã—Ö –¥–µ–ø—É—Ç–∞—Ç–æ–≤, –æ–Ω –∂–µ –°—ä–µ–∑–¥ –°–æ–≤–µ—Ç–æ–≤ –≤ 1922 –≥–æ–¥—É —Å–æ–∑–¥–∞–≤–∞–ª –°–°–°–†, —Ç–æ –∏ —Ä–∞—Å–ø—É—Å–∫–∞—Ç—å –Ω—É–∂–Ω–æ –±—ã–ª–æ –µ–≥–æ –ø–æ —Ä–µ—à–µ–Ω–∏—é –°—ä–µ–∑–¥–∞ —ç—Ç–∏—Ö —Å–∞–º—ã—Ö –¥–µ–ø—É—Ç–∞—Ç–æ–≤¬ª, ‚Äì –æ—Ç–º–µ—Ç–∏–ª –æ–Ω

–ü–æ —Å–ª–æ–≤–∞–º –ö–æ–±—è–∫–æ–≤–∞, ¬´—Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ —Å—Ç—Ä–∞–Ω–Ω—ã–º¬ª —Å –ø—Ä–∞–≤–æ–≤–æ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≤—ã–≥–ª—è–¥–∏—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ –ë–µ–ª–æ–≤–µ–∂—Å–∫–∏—Ö —Å–æ–≥–ª–∞—à–µ–Ω–∏–π 8 –¥–µ–∫–∞–±—Ä—è 1991 –≥–æ–¥–∞. ¬´–≠—Ç–∏ –∞–∫—Ç—ã –ø–æ–∑–∂–µ —Ä–∞—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª–∏ –í–µ—Ä—Ö–æ–≤–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –†–°–§–°–†, –£–°–°–†, –ë–°–°–†, –∞ —ç—Ç–æ –≤–æ–æ–±—â–µ –Ω–µ –≤ –∏—Ö –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏¬ª, ‚Äì –¥–æ–±–∞–≤–∏–ª —Å–æ–≤–µ—Ç–Ω–∏–∫ –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞
"""
print(get_topics(post))

